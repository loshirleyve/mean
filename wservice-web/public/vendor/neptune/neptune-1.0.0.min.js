/*! neptune  2015-11-05*/
angular.module("ui.neptune",["ui.bootstrap","ui.neptune.tpls","ui.neptune.datatable","ui.neptune.resource"]),angular.module("ui.neptune.tpls",["/template/datatable/datatable.html"]),angular.module("ui.neptune.datatable",[]).provider("DatatableStore",function(){this.storeConfig={},this.config={currPage:1,maxSize:10,itemsPerPage:5,isIndex:!1,isPagination:!1},this.store=function(a,b){if(b||(b=a,a=b.name),!a)throw new Error("must have name.");return this.storeConfig[a]=b,this},this.$get=function(){var a=this,b={getStore:function(b,c){c&&c(a.storeConfig[b])},getConfig:function(){return a.config}};return b}}).controller("datatableControll",["$scope","$attrs",function(a,b){this.$init=function(b){this.config=b,a.currPage=a.currPage||b.currPage,a.totalItems=0,a.data&&(a.totalItems=a.data.length||0),a.maxSize=b.maxSize,a.itemsPerPage=a.itemsPerPage||b.itemsPerPage,a.pageData=[],a.isIndex=a.isIndex||b.isIndex,a.isPagination=a.isPagination||b.isPagination},this.$pageChange=function(){a.pageData=[];var b=0,c=0;for(a.isPagination?(b=a.currPage*a.itemsPerPage,c=a.currPage*a.itemsPerPage-a.itemsPerPage):(c=0,b=0,a.data&&(b=a.data.length)),c;b>c&&!(c>=a.data.length);c++)a.pageData.push(a.data[c])},a.doAction=function(b,c,d){a.onAction&&a.onAction({type:b,item:c,index:d})}}]).directive("nptDatatable",["DatatableStore","$parse","Store",function(a,b,c){return{restrict:"E",controller:"datatableControll",transclude:!0,replace:!0,templateUrl:function(a,b){return b.templateUrl||"/template/datatable/datatable.html"},scope:{name:"@",header:"=?",data:"=",action:"=?",isIndex:"=?",isPagination:"@",itemsPerPage:"=?",onAction:"&"},link:function(c,d,e,f){if(f.$init(a.getConfig()),a.getStore(c.name,function(a){!c.header&&a&&a.header&&(c.header=a.header),!c.action&&a&&a.action&&(c.action=a.action)}),c.$watchCollection("data",function(a,b){angular.isDefined(a)&&null!==a&&(c.totalItems=a.length,f.$pageChange())}),c.$watch("currPage",function(a,b){f.$pageChange()}),e.name&&c.$parent){var g=b(e.name).assign;g(c.$parent,f)}}}}]),angular.module("ui.neptune.resource",[]).provider("Resource",function(){this.params={},this.header={},this.backendUrl="/service",this.cache={},this.originData={},this.setBackendUrl=function(a){this.backendUrl=a},this.$get=function(a){var b=this,c={post:function(c,d,e,f){d=d||{},angular.extend(d,b.params),a.post(b.backendUrl,{y9action:{name:c,params:d}}).success(function(a){if(b.originData=a,"100"===a.code){if(a.cache)for(var c in a.cache){var d=b.cache[c]||{};b.cache[c]=angular.extend(d,a.cache[c])}e&&e(a.data)}else f&&f(a)}).error(function(a){b.originData=a,f&&f(a)})},cache:function(a,c){return a||c?a&&!c?b.cache[a]:a&&c&&b.cache[a]?b.cache[a][c]:void 0:b.cache},originData:function(){return b.originData}};return c}}),angular.module("/template/datatable/datatable.html",[]).run(["$templateCache",function(a){a.put("/template/datatable/datatable.html",'<div><div style="padding-top:10px;" class="row"><div class="col-md-12"><!-- 设置为响应式表格 当页面宽度不够显示表格内容时会出现滚动条--><div class="table-responsive"><!-- table-striped表示隔行显示不同颜色条纹；table-hover鼠标悬停变色；table-bordered表格线框;table-condensed紧缩表格--><table class="table table-striped table-bordered table-hover table-condensed"><tfoot><tr ng-show="isPagination"><td colspan="50"><uib-pagination style="margin:0px;" total-items="totalItems" ng-model="currPage" items-per-page="itemsPerPage" max-size="maxSize" boundary-links="true" first-text="首页" previous-text="上一页" next-text="下一页" last-text="尾页" class="pagination-sm"></uib-pagination></td></tr></tfoot><thead><tr ng-show="isPagination"><td colspan="50"><uib-pagination style="margin:0px;" total-items="totalItems" ng-model="currPage" items-per-page="itemsPerPage" max-size="maxSize" boundary-links="true" first-text="首页" previous-text="上一页" next-text="下一页" last-text="尾页" class="pagination-sm"></uib-pagination></td></tr><tr><th ng-if="isIndex" class="text-center">&#24207;&#21495;</th><th ng-repeat="item in header" class="text-center">{{item.label}}</th><th ng-if="action.length&gt;0" class="text-center">&#25805;&#20316;</th></tr></thead><tbody><tr ng-repeat="item in pageData"><td ng-if="isIndex" class="text-center">{{($index+1)+(currPage * itemsPerPage - itemsPerPage\n)}}</td><td ng-repeat="headerItem in header">{{item[headerItem.name]}}</td><td ng-if="action.length&gt;0"><a ng-repeat="actionItem in action" href="" ng-click="doAction(actionItem.name,item,currPage * itemsPerPage - itemsPerPage + $parent.$index)" class="btn btn-primary btn-sm">{{actionItem.label}}</a></td></tr></tbody></table></div></div></div></div>')}]),angular.module("/template/form/form.html",[]).run(["$templateCache",function(a){a.put("/template/form/form.html",'<form class="form-horizontal"><div ng-repeat="item in config" class="form-group"><label for="{{item.name}}" class="col-sm-2 control-label">{{item.label}}</label><div class="col-sm-10"><input id="{{item.name}}" type="{{item.type || text}}" placeholder="{{item.label}}" value="{{data[item.name]}}" class="form-control"></div></div><div class="form-group"><div class="col-sm-offset-2 col-sm-10"><button type="button" ng-click="doSave()" class="btn btn-primary">保存</button>&nbsp<button type="button" ng-click="doReset()" class="btn btn-danger">重置</button>&nbsp\n&nbsp\n&nbsp\n&nbsp<button type="button" ng-repeat="item in action" ng-click="doAction(item)" class="btn btn-default">{{item.label}}</button></div></div></form>')}]);