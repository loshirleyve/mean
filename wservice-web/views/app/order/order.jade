//
   Created by Leon on 15/10/15.

extends ../../layout/layout-bizpage

block content

    script(src="/js/bpc/orderconfig.js")
    script(src="/js/app/order.js")
    div(ng-app="orderApp")
        //通知区域

        //内容区域
        div(ng-view)
        //组织结构树模板
        script(type="text/ng-template",id="org_nodes.html")
            div.tree-node.tree-node-content(ui-tree-handle)
                a.btn.btn-success.btn-xs(ng-if="node.nodes && node.nodes.length > 0",ng-click="toggle(this)")
                    span.glyphicon(ng-class="{'glyphicon-chevron-right': collapsed,'glyphicon-chevron-down': !collapsed}")
                | &nbsp &nbsp
                a.btn-link(ng-click="clickOrg(node)") {{node.title}}

            ol(ui-tree-nodes="",ng-model="node.nodes",ng-class="{hidden:collapsed}")
                li(ng-repeat="node in node.nodes",ui-tree-node,ng-include="'org_nodes.html'")

        //列表模板
        script(type="text/ng-template",id="list.html")
            //功能导航区域
            div.row
                div.col-md-12
                    ul.breadcrumb
                        li
                            a(href="/home")
                                span.glyphicon.glyphicon-home
                                span 首页
                        li.active 订单列表
            //功能按钮区域
            div.row
                div.col-md-12
                    div.btn-group
                        label.btn.btn-primary.btn-sm(ng-model="query.state" uib-btn-radio="'all'",ng-click="queryByState()" data-loading-text="正在查询...",id="all") 全部
                        label.btn.btn-primary.btn-sm(ng-model="query.state" uib-btn-radio="'waitconfirm'",ng-click="queryByState()" data-loading-text="正在查询...",id="waitconfirm") 待确认
                        label.btn.btn-primary.btn-sm(ng-model="query.state" uib-btn-radio="'buy'",ng-click="queryByState()" data-loading-text="正在查询...",id="buy") 待支付
                        label.btn.btn-primary.btn-sm(ng-model="query.state" uib-btn-radio="'inservice'",ng-click="queryByState()" data-loading-text="正在查询...",id="inservice") 服务中
                    | &nbsp
                    label.btn.btn-primary.btn-sm(ng-click="query.toggle()",data-loading-text="正在查询...",id="query") {{query.text}}
                    | &nbsp
                    label.btn.btn-primary.btn-sm(ng-click="checkNew.toggle()",data-loading-text="正在查询...",id="checkNew") {{checkNew.text}}
            p
            //检查新订单区域
            div.row
                div.col-md-12
                    div(uib-collapse="!checkNew.isCollapsed")
                        div.well.well-lg 检查新订单
            //条件查询内容输入区域
            div.row
                div.col-md-12
                    div(uib-collapse="!query.isCollapsed")
                        div.well.well-lg 条件查询内容
            //数据表格区域
            div.row
                div.col-md-12
                    y9ui-datatable(is-pagination="true",items-per-page="10",header="header",data="data",action="action",is-index="true",on-action="orderAction(type,item,index)")
        //详情模板
        script(type="text/ng-template",id="detail.html")
            //功能导航区域
            div.row
                div.col-md-12
                    ul.breadcrumb
                        li
                            a(href="/home")
                                span.glyphicon.glyphicon-home
                                span 首页
                        li
                            a(href="#list")
                                span 订单列表
                        li.active 订单详情

            nav.navbar.navbar-default
                div.navbar-header
                    a.navbar-brand(href="") 订单详情
                ul.nav.navbar-nav.navbar-right
                    li
                        a(href="#/confirm/{{orderid}}",ng-show="isConfirm") 确认订单
                    li
                        a(href="#/adviser/{{orderid}}") 分配顾问
                    li
                        a(href="",ng-click="query.previous(orderid)",ng-show="{{query.previousId(orderid)}}") 上一单
                    li
                        a(href="",ng-click="query.next(orderid)",ng-show="{{query.nextId(orderid)}}") 下一单
                    li
                        a(href="#/list") 返回
                    li
                        | &nbsp &nbsp &nbsp &nbsp

            div.row
                div.col-md-12
                    div.panel.panel-default
                        div.panel-heading 基本信息
                        div.panel-body
                            form.form-horizontal
                                div.form-group
                                    label.col-md-2.control-label(for="ordersn") 订单编号:
                                    div.col-md-10
                                        input.form-control(type="text",id="ordersn",value="{{data.order.ordersn}}",disabled)
                                div.form-group
                                    label.col-md-2.control-label(for="buyerinstid") 客户名称:
                                    div.col-md-10
                                        input.form-control(type="text",id="buyerinstid",value="{{data.order.buyerinstid}}",disabled)
                                div.form-group
                                    label.col-md-2.control-label(for="begindate") 开始日期:
                                    div.col-md-10
                                        input.form-control(type="text",id="begindate",value="{{data.order.begindate}}",disabled)
                                div.form-group
                                    label.col-md-2.control-label(for="enddate") 结束日期:
                                    div.col-md-10
                                        input.form-control(type="text",id="enddate",value="{{data.order.enddate}}",disabled)
                                div.form-group
                                    label.col-md-2.control-label(for="orderamount") 订单金额:
                                    div.col-md-10
                                        input.form-control(type="text",id="orderamount",value="{{data.order.orderamount}}",disabled)
                                div.form-group
                                    label.col-md-2.control-label(for="factamount") 实际金额:
                                    div.col-md-10
                                        input.form-control(type="text",id="factamount",value="{{data.order.factamount}}",disabled)
                                div.form-group
                                    label.col-md-2.control-label(for="createdate") 创建日期:
                                    div.col-md-10
                                        input.form-control(type="text",id="createdate",value="{{data.order.createdate}}",disabled)
                                div.form-group
                                    label.col-md-2.control-label(for="remark") 备注:
                                    div.col-md-10
                                        textarea.form-control(rows=3,id="remark",disabled) {{data.order.remark}}
            div.row
                div.col-md-12
                    div.panel.panel-default
                        div.panel-heading 产品列表
                        y9ui-datatable(header="productHeader",data="data.orderproducts",action="productAction",is-index="true",on-action="doOrderProducts(type,item,index)")
            div.row
                div.col-md-12
                    div.panel.panel-default
                        div.panel-heading 工单列表
                        y9ui-datatable(header="workOrderHeader",data="data.workorders",action="workOrderAction",is-index="true",on-action="doWorkorders(type,item,index)")

        //确认订单模板
        script(type="text/ng-template",id="confirm.html")
            //弹出选择用户模态狂,注意必须在模板中,否则无法加载控制器数据
            div.modal.fade(id="selectUserId",tabindex="-1",role="dialog")
                div.modal-dialog.modal-lg
                    div.modal-content
                        div.modal-header
                            button.close(type='button',ng-click="closeSelectUser()",aria-label="关闭")
                                span &times
                            h4.modal-title 选择用户
                        div.modal-body
                            div.row
                                div.col-md-4
                                    div(ui-tree,id="tree-root",data-drag-enabled="false")
                                        ol(ui-tree-nodes ng-model="org.data")
                                            li(ng-repeat="node in org.data",ui-tree-node,ng-include="'org_nodes.html'")
                                div.col-md-8
                                    y9ui-datatable(is-pagination="true",items-per-page="5",header="userListHeader",data="orgUsers",action="userListAction",is-index="true",on-action="onSelectUser(type,item,index)")
                        div.modal-footer
                            button.btn.btn-default(ng-click="closeSelectUser()") 关闭



            div.row
                div.col-md-12
                    //功能导航区域
                    div.row
                        div.col-md-12
                            ul.breadcrumb
                                li
                                    a(href="/home")
                                        span.glyphicon.glyphicon-home
                                        span 首页
                                li
                                    a(href="#list")
                                        span 订单列表
                                li
                                    a(href="#detail/{{orderid}}")
                                        span 订单详情
                                li.active 确认订单

                    nav.navbar.navbar-default
                        div.navbar-header
                            a.navbar-brand(href="") 确认订单
                        ul.nav.navbar-nav.navbar-right
                            li
                                a(href="#detail/{{orderid}}") 返回
                            li
                                | &nbsp &nbsp &nbsp &nbsp

                    div.row
                        div.col-md-12
                            div.panel.panel-primary
                                div.panel-heading 订单信息
                                div.panel-body
                                    form.form-horizontal(name="confirmForm")
                                        div.form-group
                                            label.col-md-2.control-label(for="ordersn") 订单编号:
                                            div.col-md-10
                                                input.form-control(type="text",id="ordersn",value="{{data.order.ordersn}}",disabled)
                                        div.form-group
                                            label.col-md-2.control-label(for="buyerinstid") 客户名称:
                                            div.col-md-10
                                                input.form-control(type="text",id="buyerinstid",value="{{data.order.buyerinstid}}",disabled)
                                        div.form-group(ng-class="{'has-error': confirmForm.begindate.$dirty && confirmForm.begindate.$invalid}")
                                            label.col-md-2.control-label(for="begindate") 开始日期:
                                            div.col-md-10
                                                input.form-control(type="number",id="begindate",name="begindate",ng-model="begindate",placeholder="请输入8位数字的日期.例如:20150808",ng-minlength="8",ng-maxlength="8",required,number2date)
                                                span.glyphicon.glyphicon-ok.form-control-feedback(ng-show="confirmForm.begindate.$dirty && confirmForm.begindate.$valid")
                                        div.form-group(ng-class="{'has-error': confirmForm.enddate.$dirty && confirmForm.enddate.$invalid}")
                                            label.col-md-2.control-label(for="enddate") 结束日期:
                                            div.col-md-10
                                                input.form-control(type="number",id="enddate",name="enddate",ng-model="enddate",placeholder="请输入8位数字的日期.例如:20150808",ng-minlength="8",ng-maxlength="8",required,number2date)
                                                span.glyphicon.glyphicon-ok.form-control-feedback(ng-show="confirmForm.enddate.$dirty && confirmForm.enddate.$valid")
                                        div.form-group
                                            label.col-md-2.control-label(for="adviserName") 专属顾问:
                                            div.col-md-10
                                                div.input-group
                                                    span.input-group-btn
                                                        button.btn.btn-primary(type="button",ng-click="openSelectUser()") 选择专属顾问
                                                    input.form-control(type="text",id="adviserName",name="adviserName",placeholder="请选择专属顾问",ng-model="adviserName",required,disabled)
                                                    span.glyphicon.glyphicon-ok.form-control-feedback(ng-show="confirmForm.adviserName.$dirty && confirmForm.adviserName.$valid")
                                        div.form-group
                                            label.col-md-2.control-label(for="orderamount") 订单金额:
                                            div.col-md-10
                                                input.form-control(type="text",id="orderamount",value="{{data.order.orderamount}}",disabled)
                                        div.form-group
                                            label.col-md-2.control-label(for="factamount") 实际金额:
                                            div.col-md-10
                                                input.form-control(type="text",id="factamount",value="{{data.order.factamount}}",disabled)
                                        div.form-group
                                            label.col-md-2.control-label(for="createdate") 创建日期:
                                            div.col-md-10
                                                input.form-control(type="text",id="createdate",value="{{data.order.createdate}}",disabled)
                                        div.form-group
                                            label.col-md-2.control-label(for="remark") 备注:
                                            div.col-md-10
                                                textarea.form-control(rows=3,id="remark",disabled) {{data.order.remark}}

                                        div.form-group
                                            div.col-sm-offset-2.col-md-10
                                                button.btn.btn-primary(type="button",ng-click="confirm()",ng-disabled="!(confirmForm.$dirty && confirmForm.$valid)") 确认订单
                                                | &nbsp &nbsp
                                                a.btn.btn-default(type="button",href="#/detail/{{orderid}}") 返回




        //分配顾问模板
        script(type="text/ng-template",id="adviser.html")
            div.row
                div.col-md-12
                    //功能导航区域
                    div.row
                        div.col-md-12
                            ul.breadcrumb
                                li
                                    a(href="/home")
                                        span.glyphicon.glyphicon-home
                                        span 首页
                                li
                                    a(href="#list")
                                        span 订单列表
                                li
                                    a(href="#detail/{{orderid}}")
                                        span 订单详情
                                li.active 分配专属顾问

                    nav.navbar.navbar-default
                        div.navbar-header
                            a.navbar-brand(href="") 分配专属顾问
                        ul.nav.navbar-nav.navbar-right
                            li
                                a(href="#detail/{{orderid}}") 返回
                            li
                                | &nbsp &nbsp &nbsp &nbsp

                    div.row
                        div.col-md-12
                            div.panel.panel-primary
                                div.panel-heading 选择专属顾问
                                div.panel-body
                                    div.row
                                        div.col-md-4
                                            div(ui-tree,id="tree-root",data-drag-enabled="false")
                                                ol(ui-tree-nodes ng-model="org.data")
                                                    li(ng-repeat="node in org.data",ui-tree-node,ng-include="'org_nodes.html'")
                                        div.col-md-8
                                            H1 用户列表


