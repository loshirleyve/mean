//
   Created by Leon on 15/10/15.

extends ../../layout/layout-bizpage
block titleContent
    title 合同管理
block content
    script(src="/js/biz/contract/contractListGrid.js")
    script(src="/js/biz/contract/addContractForm.js")
    script(src="/js/biz/contract/contract.js")
    div(ng-app="contractApp")
        //通知区域
        //内容区域
        div(ng-view)

        //列表模板
        script(type="text/ng-template",id="list.html")
            //功能导航区域
            ul.breadcrumb
                li
                    a(href="app/home")
                        span.glyphicon.glyphicon-home
                        span 首页
                li.active 合同列表
            //功能按钮区域
            nav.navbar.navbar-default.navbar-fixed-top
                div.container-fluid
                    div.navbar-header
                        button.navbar-toggle.collapsed(type='button', data-toggle='collapse', data-target='#navbar-collapse', aria-expanded='false')
                            span.sr-only Toggle navigation
                            span.icon-bar
                            span.icon-bar
                            span.icon-bar
                        a.navbar-brand(href="#/addContract") 合同列表
                    div#navbar-collapse.collapse.navbar-collapse
                        ul.nav.navbar-nav.navbar-right
                            li
                                a(href="#/addContract") 新增合同
            div(npt-grid="vm.contractListGridOptions",model="vm.queryListService.contractList.data")


        //新增客户模板
        script(type="text/ng-template", id="addContract.html")
            //功能导航区域
            ul.breadcrumb
                li
                    a(href="/app/home")
                        span.glyphicon.glyphicon-home
                        span 首页
                li
                    a(href="#list")
                        span 客户列表
                li.active 新增客户

            nav.navbar.navbar-default.navbar-fixed-top
                div.container-fluid
                    div.navbar-header
                        button.navbar-toggle.collapsed(type='button', data-toggle='collapse', data-target='#navbar-collapse', aria-expanded='false')
                            span.sr-only Toggle navigation
                            span.icon-bar
                            span.icon-bar
                            span.icon-bar
                        a.navbar-brand(href="") 新增合同
                    div#navbar-collapse.collapse.navbar-collapse.navbar-right
                        ul.nav.navbar-nav.navbar-right(ng-if="vm.addContract.loading()")
                            li
                                a(href="") 正在保存,请稍后...
                        ul.nav.navbar-nav.navbar-right(ng-if="!vm.addContract.loading()")
                            li
                                a(href="",ng-disabled="vm.nptFormApi.form.$invalid", ng-click="vm.addContractSave(vm.model)") 保存
                            li
                                a(href="",ng-click="vm.reset()") 重置
                            li
                                a(href="#/list") 返回
                            li
                                | &nbsp &nbsp &nbsp &nbsp

            //数据表单区域
            div.page-header
                h4 基本信息
            div.page-body
                div(npt-form="vm.addContractFormOptions",model="vm.model")

        //详情模版
        script(type="text/ng-template",id="detail.html")
            //功能导航区域
            ul.breadcrumb
                li
                    a(href="/home")
                        span.glyphicon.glyphicon-home
                        span 首页
                li
                    a(href="#/list")
                        span 合同列表
                li.active 合同详情
            nav.navbar.navbar-default.navbar-fixed-top
                div.container-fluid
                    div.navbar-header
                        button.navbar-toggle.collapsed(type='button', data-toggle='collapse', data-target='#navbar-collapse', aria-expanded='false')
                            span.sr-only Toggle navigation
                            span.icon-bar
                            span.icon-bar
                            span.icon-bar
                        a.navbar-brand(href="") 合同详情
                    div#navbar-collapse.collapse.navbar-collapse.navbar-right
                        ul.nav.navbar-nav.navbar-left(ng-if="vm.contractInfo.loading()")
                            li
                                a(href="") 正在查询,请稍后...
                        ul.nav.navbar-nav.navbar-left(ng-if="!vm.contractInfo.loading()")
                            li(ng-if="!vm.workorderInfo.loading()")
                                a(href="",ng-click="vm.previous(vm.workorderInfo.data.workOrder)",ng-show="vm.workorderList.previous(vm.workorderInfo.data.workOrder)") 上一
                            li(ng-if="!vm.orderInfo.loading()")
                                a(href="",ng-click="vm.next(vm.workorderInfo.data.workOrder)",ng-show="vm.workorderList.next(vm.workorderInfo.data.workOrder)") 下一单
                            li
                                a(href="#/startWorkorder/{{vm.workorderInfo.data.workOrder.id}}",ng-show="vm.isUnstart()") 开始做
                            li
                                a(href="#/completeWorkorder/{{vm.workorderInfo.data.workOrder.id}}",ng-show="vm.isInservice()") 完成
                            li
                                a(href="#/deliverWorkorder/{{vm.workorderInfo.data.workOrder.id}}",ng-show="vm.isNotComplete()") 转交
                            li
                                a(href="#/list") 返回
            div.page-header
                h4 基本信息
            div.page-body
                dl.dl-horizontal
                    dt 机构:
                    dd {{vm.contractInfo.data.instid | cacheFilter:'inst':'instname':'instid'}}
                    dt 项目:
                    dd {{vm.contractInfo.data.projectid}}
                    dt 专柜名称:
                    dd {{vm.contractInfo.data.shoppename}}
                    dt 经营品牌:
                    dd {{vm.contractInfo.data.trademark}}
                    dt 是否保底:
                    dd {{vm.contractInfo.data.isbase}}
                    dt 审核状态:
                    dd
                        strong {{vm.contractInfo.data.state}}
                    dt 租金:
                    dd {{vm.contractInfo.data.rent}}
                    dt 保底金额:
                    dd {{vm.contractInfo.data.baseamount}}
                    dt 基本扣率:
                    dd {{vm.contractInfo.data.baserate}}
                    dt 超额扣率:
                    dd {{vm.contractInfo.data.extralbaserate}}
                    dt 进场费:
                    dd {{vm.contractInfo.data.slottingfee}}
                    dt 保证金:
                    dd {{vm.contractInfo.data.deposit}}
                    dt 其他费用:
                    dd {{vm.contractInfo.data.other}}
                    dt 补充条款:
                    dd {{vm.contractInfo.data.clause}}
                    dt 创建日期:
                    dd {{vm.contractInfo.data.createdate | timestampFilter}}
            div.page-header
                div.row
                    div.col-xs-6.col-md-6
                        h4 合同附件
            div.page-body
                div.list-group
                    div.list-group-item(ng-repeat="item in vm.contractAttachment")
                        div.list-group-item-heading
                            div.row
                                div.col-xs-6.col-md-3
                                    //h5(ng-if="item.inputtype != 'file'") {{item.attachname}}
                                    div(ng-if="item.inputtype === 'image'")
                                        a(href = "{{item.inputvalue | cacheFilter:'file':'url':'id'}}" target="_blank") {{item.attachname}}
                                        div.thumbnail
                                            div(npt-image="item.inputvalue" onload='if (this.width>160 || this.height>226) if (this.width/this.height>160/226) this.width=160; else this.height=226;')
                                    div(ng-if="item.inputtype === 'text'")
                                        h5 {{item.attachname}}
                                        p {{item.inputvalue}}
                                    a(ng-if="item.inputtype === 'file'",href = "{{item.inputvalue | cacheFilter:'file':'url':'id'}}") {{item.attachname}}
                        div.list-group-item-text

                            p 资料交接类型:{{item.transfertype | ctrlCodeFilter:'transfertype':'name':'no'}}
                            p 资料类型:{{item.inputtype | ctrlCodeFilter:'inputtype':'name':'no'}}